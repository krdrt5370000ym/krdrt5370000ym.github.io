<!DOCTYPE html>
<html lang="pl">
<head>
    <meta http-equiv="X-UA-Compatible" content="requiresActiveX=true"/>
    <meta charset="UTF-8">
    <title>Radio M3U Player</title>
    <script src="https://krdrt5370000ym.github.io/site-head.js"></script>
    <style>
        body { display: flex; height: 100vh; margin: 0; background: #181818; color: white; }
        #sidebar { @media (max-width:600px) {width:150px;font-size:10px;}; @media (min-width:600px) {width:300px;}; background: #222; border-right: 1px solid #333; overflow-y: auto; padding: 10px; }
        #content { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .station-item { padding: 10px; border-bottom: 1px solid #333; cursor: pointer; transition: 0.2s; }
        .station-item:hover { background: #333; }
        .station-item.active { background: #007bff; color: white; }
        audio { width: 100%; max-width: 400px; margin-top: 20px; }
        input { width: 100%; padding: 8px; margin-bottom: 10px; background: #333; border: 1px solid #444; color: white; }
    </style>
</head>
<body>

<div id="sidebar">
    <h3>Stacje Radiowe</h3>

    <div id="playlist-container"></div>
</div>

<div id="content">
    <h2 id="current-station">Wybierz stację z listy</h2>
    <audio id="player" controls></audio>
</div>

<script>
    async function fetchPlaylist() {
        const url = "https://krdrt5370000ym.github.io/app/Radio1.m3u";
        try {
            const response = await fetch(url);
            const text = await response.text();
            const playlist = parseM3U(text);
            displayPlaylist(playlist);
        } catch (err) {
            alert("Błąd ładowania listy. Upewnij się, że link jest poprawny i serwer pozwala na CORS.");
        }
    }

    function parseM3U(data) {
        const lines = data.split('\n');
        const stations = [];
        let currentName = "";

        for (let i = 0; i < lines.length; i++) {
            const line = lines[i].trim();
            if (line.startsWith('#EXTINF:')) {
                // Wyciąganie nazwy stacji po przecinku
                currentName = line.split('-1,').pop() || "Nieznana stacja";
            } else if (line.startsWith('http')) {
                stations.push({ name: currentName || "Stacja " + (stations.length + 1), url: line });
                currentName = ""; // Reset dla kolejnej stacji
            }
        }
        return stations;
    }

    function displayPlaylist(stations) {
        const container = document.getElementById('playlist-container');
        container.innerHTML = "";
        stations.forEach(station => {
            const div = document.createElement('div');
            div.className = 'station-item';
            div.innerText = station.name;
            div.onclick = () => playStation(station, div);
            container.appendChild(div);
        });
    }

    function playStation(station, element) {
        const player = document.getElementById('player');
        const title = document.getElementById('current-station');
        
        // Aktualizacja UI
        document.querySelectorAll('.station-item').forEach(el => el.classList.remove('active'));
        element.classList.add('active');
        
        title.innerText = "Teraz grasz: " + station.name;
        player.src = station.url;
        player.play();
    }
</script>
<script>fetchPlaylist()</script>

</body>
</html>
